<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      lang="en">
<head th:replace="fragments.html :: html_head">
</head>
<body>
    <nav th:replace="fragments :: navbar">
        Static Navbar
    </nav>
    <div class="container page-container">
        <div class="alert alert-dismissible alert-success" role="alert" th:text="${success}" th:if="${success}">
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <!-- review -->
        <div class="review-container">
            <div class="row">
                <div class=" col-5 col-lg-3 offset-lg-2">
                    <div class="review-movie-info">
                        <!-- review image -->
                        <div class="review-img-container ">
                            <img th:src="@{${review.movie.posterImagePath}}" class="img review-img">
                        </div>
                        <p>Year: [[${review.movie.year}]]</p>
                        <p>Genre: [[${review.movie.genre}]]</p>
                        <p>Director: [[${review.movie.director}]]</p>
                        <p>re:Viewer rating: [[${review.movie.avgRating}]]</p>

                    </div>
                </div>

                <div class=" col-7 col-lg-5">
                    <!-- review content -->
                    <h3>Review of [[${review.movie.title}]]</h3>
                    <p>by
                        <a class="username-link" th:href="@{/user/{id}(id=${review.user.userID})}">
                            [[${review.user.userName}]]
                        </a>
                    </p>
                    <hr>
                    <p class="review-content">[[${review.content}]]</p>
                    <p>Rating: [[${review.rating}]] out of 5</p>
                    <hr>
                    <p>created: [[${#dates.format(review.createdAt, 'HH:mm dd-MM-yyyy')}]]</p>
                    <p>No of likes: [[${#lists.size(review.reviewLikes)}]]</p>
                    <div>
                        <form th:action="@{/like_review/{id}(id=${review.reviewID})}" method="post">
                            <div sec:authorize="isAnonymous()">
                                <button type="submit" class="btn btn-success btn-sm disabled" >Like Review</button>
                                <p class="text-muted">
                                    <a th:href="@{/login}">Sign In</a> or <a th:href="@{/register}">Register</a> to like a review!
                                </p>
                            </div>
                            <div>
                                <button type="submit" class="btn btn-success btn-sm" sec:authorize="isAuthenticated()">Like Review</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- review comments -->
        <div class="comment-container">
            <div class="row">

                <!-- comments -->
                <div class="col-12 col-lg-6 offset-lg-3">
                    <p class="text-center">
                        There are [[${#lists.size(review.comments)}]] comments on this review
                    </p>
                    <hr>
                    <div th:each="c : ${#lists.sort(commentList)}">


                        <span>
                            <a class="username-link" th:href="@{/user/{id}(id=${c.user.userID})}">
                                [[${c.user.userName}]]
                            </a>
                            <em>commented:</em>
                        </span>

                        <div class="comment-body bg-light">
                            <span>[[${c.text}]]</span>
                        </div>
                        <div class="comment-time">[[${#dates.format(c.createdAt, 'HH:mm dd-MM-yyyy')}]]</div>
                        <hr>
                    </div>
                </div>

                <!-- comment form -->
                <div class="col-12 col-lg-6 offset-lg-3">
                    <div class="comment-form">
                        <form th:action="@{/save_comment/{id}(id=${review.reviewID})}" th:object="${newComment}" method="post">
                            <div class="form-group" >
                                <label for="exampleTextarea" class="form-label mt-4" >Example textarea</label>
                                <textarea class="form-control new-comment" id="exampleTextarea" rows="3" th:field="*{text}" required></textarea>
                                <button type="submit" class="btn btn-success">Submit</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>



    </div>

    <div th:replace="fragments :: footer">Static Footer</div>

    <th:block th:insert="fragments :: scripts">
    </th:block>

</body>
</html>